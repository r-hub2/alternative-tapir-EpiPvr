<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="R. Donnelly" />

<meta name="date" content="2025-09-14" />

<title>Using the EpiPvr package to analyse access period data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using the EpiPvr package to analyse access
period data</h1>
<h4 class="author">R. Donnelly</h4>
<h4 class="date">2025-09-14</h4>



<div id="r-markdown" class="section level2">
<h2>R Markdown</h2>
<p><strong>This vignette illustrates the analysis of access period
datasets with the EpiPvr package.</strong> First for semi-persistently
transmitted viruses and then for persistently transmitted viruses we use
simulated AP datasets to demonstrate virus parameter estimation. This
process leads to posterior distributions for viral parameters.</p>
<p>In the EpiPvr package we also include a function for calculating the
probability of a local epidemic for a single introduced inoculum. This
function requires virus parameters and local parameters. We show how to
take samples from the posterior distributions for the virus parameters
(as outlined above) and to use them to calculate epidemic probability in
local conditions.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>virus_type<span class="ot">=</span><span class="st">&#39;SPT&#39;</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>lsEst_in<span class="ot">=</span><span class="dv">40</span>; <span class="co"># upper bound on per insect survival in the experiment in days</span></span></code></pre></div>
<p>Loading the example dataset for an SPT virus. See package
documentation entry for the ap_data_sim_SPT dataset for explanation of
the dataset columns which correspond to AP experiment structure.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ap_data_sim_SPT&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ap_data_sim_SPT)</span></code></pre></div>
<pre><code>#&gt; $d_AAP
#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
#&gt; T_vec    2    3  3.5    4  4.5    5    6    8
#&gt; R_vec   30   30 30.0   30 30.0   30   30   30
#&gt; I_vec   16   19 20.0   15 18.0   15   16   16
#&gt; 
#&gt; $d_IAP
#&gt;              [,1]       [,2]  [,3]       [,4]       [,5] [,6]       [,7]
#&gt; T_vec  0.08333333  0.1666667  0.25  0.3333333  0.4166667  0.5  0.6666667
#&gt; R_vec 30.00000000 30.0000000 30.00 30.0000000 30.0000000 30.0 30.0000000
#&gt; I_vec  4.00000000  6.0000000  9.00 13.0000000 13.0000000  8.0 14.0000000
#&gt;             [,8] [,9]
#&gt; T_vec  0.8333333    1
#&gt; R_vec 30.0000000   30
#&gt; I_vec 13.0000000   22
#&gt; 
#&gt; $d_durations
#&gt;      [,1] [,2]
#&gt; [1,]   -1    6
#&gt; [2,]    4   -1
#&gt; 
#&gt; $d_vectorspp
#&gt; [1] 20
#&gt; 
#&gt; $d_virusType
#&gt; [1] &quot;SPT&quot;
#&gt; 
#&gt; attr(,&quot;alpha&quot;)
#&gt; [1] 0.1
#&gt; attr(,&quot;beta&quot;)
#&gt; [1] 1
#&gt; attr(,&quot;mu&quot;)
#&gt; [1] 1</code></pre>
<p><strong>We now run the estimate_virus_parameters_SPT function for
viral parameter estimation</strong> from the SPT virus dataset. Note:
For runtime reasons, CRAN runs a precomputed fit. To rerun the full
analysis, set Sys.setenv(NOT_CRAN = “true”) before rebuilding the
vignette.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">identical</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;NOT_CRAN&quot;</span>), <span class="st">&quot;true&quot;</span>)) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>EVSPT_sim<span class="ot">=</span><span class="fu">estimate_virus_parameters_SPT</span>(ap_data_sim_SPT,lsEst_in,<span class="at">D_numPtsPdin=</span><span class="dv">1</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">mcmcOptions=</span><span class="fu">c</span>(<span class="dv">4500</span>,<span class="dv">6000</span>),<span class="at">numChainsIn=</span><span class="dv">4</span>,<span class="at">mc.parallel=</span><span class="dv">0</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load precomputed object for CRAN</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  EVSPT_sim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;EVSPT_sim.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>#&gt; [1] &quot;numChains = 4&quot;
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_SPT_virus&#39; NOW (CHAIN 1).
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 9.7e-05 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.97 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:    1 / 6000 [  0%]  (Warmup)
#&gt; Chain 1: Iteration:  600 / 6000 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration: 1200 / 6000 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration: 1800 / 6000 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration: 2400 / 6000 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 3000 / 6000 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 3600 / 6000 [ 60%]  (Warmup)
#&gt; Chain 1: Iteration: 4200 / 6000 [ 70%]  (Warmup)
#&gt; Chain 1: Iteration: 4501 / 6000 [ 75%]  (Sampling)
#&gt; Chain 1: Iteration: 5100 / 6000 [ 85%]  (Sampling)
#&gt; Chain 1: Iteration: 5700 / 6000 [ 95%]  (Sampling)
#&gt; Chain 1: Iteration: 6000 / 6000 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 1.503 seconds (Warm-up)
#&gt; Chain 1:                0.376 seconds (Sampling)
#&gt; Chain 1:                1.879 seconds (Total)
#&gt; Chain 1: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_SPT_virus&#39; NOW (CHAIN 2).
#&gt; Chain 2: Rejecting initial value:
#&gt; Chain 2:   Error evaluating the log probability at the initial value.
#&gt; Chain 2: Exception: binomial_lpmf: Probability parameter is -249679, but must be in the interval [0, 1] (in &#39;string&#39;, line 124, column 2 to column 73)
#&gt; Chain 2: 
#&gt; Chain 2: Gradient evaluation took 5.1e-05 seconds
#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.51 seconds.
#&gt; Chain 2: Adjust your expectations accordingly!
#&gt; Chain 2: 
#&gt; Chain 2: 
#&gt; Chain 2: Iteration:    1 / 6000 [  0%]  (Warmup)
#&gt; Chain 2: Iteration:  600 / 6000 [ 10%]  (Warmup)
#&gt; Chain 2: Iteration: 1200 / 6000 [ 20%]  (Warmup)
#&gt; Chain 2: Iteration: 1800 / 6000 [ 30%]  (Warmup)
#&gt; Chain 2: Iteration: 2400 / 6000 [ 40%]  (Warmup)
#&gt; Chain 2: Iteration: 3000 / 6000 [ 50%]  (Warmup)
#&gt; Chain 2: Iteration: 3600 / 6000 [ 60%]  (Warmup)
#&gt; Chain 2: Iteration: 4200 / 6000 [ 70%]  (Warmup)
#&gt; Chain 2: Iteration: 4501 / 6000 [ 75%]  (Sampling)
#&gt; Chain 2: Iteration: 5100 / 6000 [ 85%]  (Sampling)
#&gt; Chain 2: Iteration: 5700 / 6000 [ 95%]  (Sampling)
#&gt; Chain 2: Iteration: 6000 / 6000 [100%]  (Sampling)
#&gt; Chain 2: 
#&gt; Chain 2:  Elapsed Time: 1.363 seconds (Warm-up)
#&gt; Chain 2:                0.602 seconds (Sampling)
#&gt; Chain 2:                1.965 seconds (Total)
#&gt; Chain 2: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_SPT_virus&#39; NOW (CHAIN 3).
#&gt; Chain 3: 
#&gt; Chain 3: Gradient evaluation took 4.1e-05 seconds
#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.41 seconds.
#&gt; Chain 3: Adjust your expectations accordingly!
#&gt; Chain 3: 
#&gt; Chain 3: 
#&gt; Chain 3: Iteration:    1 / 6000 [  0%]  (Warmup)
#&gt; Chain 3: Iteration:  600 / 6000 [ 10%]  (Warmup)
#&gt; Chain 3: Iteration: 1200 / 6000 [ 20%]  (Warmup)
#&gt; Chain 3: Iteration: 1800 / 6000 [ 30%]  (Warmup)
#&gt; Chain 3: Iteration: 2400 / 6000 [ 40%]  (Warmup)
#&gt; Chain 3: Iteration: 3000 / 6000 [ 50%]  (Warmup)
#&gt; Chain 3: Iteration: 3600 / 6000 [ 60%]  (Warmup)
#&gt; Chain 3: Iteration: 4200 / 6000 [ 70%]  (Warmup)
#&gt; Chain 3: Iteration: 4501 / 6000 [ 75%]  (Sampling)
#&gt; Chain 3: Iteration: 5100 / 6000 [ 85%]  (Sampling)
#&gt; Chain 3: Iteration: 5700 / 6000 [ 95%]  (Sampling)
#&gt; Chain 3: Iteration: 6000 / 6000 [100%]  (Sampling)
#&gt; Chain 3: 
#&gt; Chain 3:  Elapsed Time: 1.315 seconds (Warm-up)
#&gt; Chain 3:                0.397 seconds (Sampling)
#&gt; Chain 3:                1.712 seconds (Total)
#&gt; Chain 3: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_SPT_virus&#39; NOW (CHAIN 4).
#&gt; Chain 4: Rejecting initial value:
#&gt; Chain 4:   Log probability evaluates to log(0), i.e. negative infinity.
#&gt; Chain 4:   Stan can&#39;t start sampling from this initial value.
#&gt; Chain 4: Rejecting initial value:
#&gt; Chain 4:   Error evaluating the log probability at the initial value.
#&gt; Chain 4: Exception: binomial_lpmf: Probability parameter is -7.45425, but must be in the interval [0, 1] (in &#39;string&#39;, line 124, column 2 to column 73)
#&gt; Chain 4: 
#&gt; Chain 4: Gradient evaluation took 3.4e-05 seconds
#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.34 seconds.
#&gt; Chain 4: Adjust your expectations accordingly!
#&gt; Chain 4: 
#&gt; Chain 4: 
#&gt; Chain 4: Iteration:    1 / 6000 [  0%]  (Warmup)
#&gt; Chain 4: Iteration:  600 / 6000 [ 10%]  (Warmup)
#&gt; Chain 4: Iteration: 1200 / 6000 [ 20%]  (Warmup)
#&gt; Chain 4: Iteration: 1800 / 6000 [ 30%]  (Warmup)
#&gt; Chain 4: Iteration: 2400 / 6000 [ 40%]  (Warmup)
#&gt; Chain 4: Iteration: 3000 / 6000 [ 50%]  (Warmup)
#&gt; Chain 4: Iteration: 3600 / 6000 [ 60%]  (Warmup)
#&gt; Chain 4: Iteration: 4200 / 6000 [ 70%]  (Warmup)
#&gt; Chain 4: Iteration: 4501 / 6000 [ 75%]  (Sampling)
#&gt; Chain 4: Iteration: 5100 / 6000 [ 85%]  (Sampling)
#&gt; Chain 4: Iteration: 5700 / 6000 [ 95%]  (Sampling)
#&gt; Chain 4: Iteration: 6000 / 6000 [100%]  (Sampling)
#&gt; Chain 4: 
#&gt; Chain 4:  Elapsed Time: 1.35 seconds (Warm-up)
#&gt; Chain 4:                0.433 seconds (Sampling)
#&gt; Chain 4:                1.783 seconds (Total)
#&gt; Chain 4:</code></pre>
<pre><code>#&gt; MESSAGE: Check core convergence diagnostics and model fit!
#&gt;  - First: Review RStan sampling messages for warnings (do NOT suppress them).
#&gt;  - R-hat &lt; 1.05 for all parameters - see array 2.
#&gt;  - Effective Sample Size (ESS) ~&gt;= 100 per chain - see array 2.
#&gt;  - Posterior predictive fit: compare simulated vs. observed (arrays 3 &amp; 4).
#&gt;  - No divergent transitions or treedepth exceedances - see converge_results.
#&gt;  More details:
#&gt;     Function help &amp; vignette (includes advanced diagnostics)
#&gt;     Stan diagnostics guide: https://mc-stan.org/docs/stan-users-guide/diagnostics.html</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>target<span class="ot">=</span>EVSPT_sim<span class="sc">$</span>array1 <span class="co"># fixing the first output array, contains the sample Markov chains</span></span></code></pre></div>
<p>First of all, note the important message printed off by default to
users of the estimate_virus_parameters_SPT and
estimate_virus_parameters_PT functions. It is important that users
recognise that they must evaluate the model fit as satisfactory before
moving forward with and/or reporting parameter estimates.</p>
<p>In the above, the MCMC sampler sends updates to the console
(e.g. chain iteration progress). Warnings relating to the initial value
are not a problem - provided that the chain settles down to smoothing
successfully.</p>
<p>Printing the dimensions and first parts of each of the seven output
objects from estimate_virus_parameters_SPT:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># viewing output content</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(EVSPT_sim<span class="sc">$</span>array0))</span></code></pre></div>
<pre><code>#&gt; [1] 1500    4    5</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(EVSPT_sim<span class="sc">$</span>array0))</span></code></pre></div>
<pre><code>#&gt; # A draws_array: 6 iterations, 4 chains, and 5 variables
#&gt; , , variable = c1[1]
#&gt; 
#&gt;          chain
#&gt; iteration     1     2     3     4
#&gt;         1 0.047 0.039 0.043 0.045
#&gt;         2 0.047 0.042 0.044 0.045
#&gt;         3 0.041 0.047 0.046 0.044
#&gt;         4 0.043 0.042 0.044 0.048
#&gt;         5 0.043 0.044 0.046 0.040
#&gt; 
#&gt; , , variable = c3[1]
#&gt; 
#&gt;          chain
#&gt; iteration   1   2   3   4
#&gt;         1 1.7 1.9 1.6 1.7
#&gt;         2 1.4 2.0 1.5 1.7
#&gt;         3 2.2 1.7 1.8 1.8
#&gt;         4 2.1 1.9 2.0 1.8
#&gt;         5 1.8 1.9 2.3 1.8
#&gt; 
#&gt; , , variable = c2[1]
#&gt; 
#&gt;          chain
#&gt; iteration    1   2    3   4
#&gt;         1 0.99 1.4 2.21 1.3
#&gt;         2 1.00 1.6 1.95 1.2
#&gt;         3 1.47 1.8 0.96 1.4
#&gt;         4 1.09 1.4 0.82 1.0
#&gt;         5 1.32 1.2 0.57 1.5
#&gt; 
#&gt; , , variable = bD[1]
#&gt; 
#&gt;          chain
#&gt; iteration   1   2   3   4
#&gt;         1  66 109 126  76
#&gt;         2  25 204 106 237
#&gt;         3 124 331 106 297
#&gt;         4 230 209  41  48
#&gt;         5 147 258 205 112
#&gt; 
#&gt; # ... with 1 more iterations, and 1 more variables</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(EVSPT_sim<span class="sc">$</span>array1))</span></code></pre></div>
<pre><code>#&gt; [1] 1500    4    3</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(EVSPT_sim<span class="sc">$</span>array1))</span></code></pre></div>
<pre><code>#&gt; # A draws_array: 6 iterations, 4 chains, and 3 variables
#&gt; , , variable = al[1]
#&gt; 
#&gt;          chain
#&gt; iteration     1    2     3     4
#&gt;         1 0.099 0.15 0.819 0.186
#&gt;         2 0.125 0.23 0.655 0.133
#&gt;         3 0.149 0.43 0.083 0.198
#&gt;         4 0.091 0.16 0.059 0.098
#&gt;         5 0.166 0.12 0.035 0.215
#&gt; 
#&gt; , , variable = be[1]
#&gt; 
#&gt;          chain
#&gt; iteration    1    2    3    4
#&gt;         1 0.80 0.67 0.18 0.54
#&gt;         2 0.54 0.61 0.19 0.66
#&gt;         3 0.91 0.33 0.96 0.57
#&gt;         4 1.06 0.68 1.24 0.90
#&gt;         5 0.61 0.80 1.76 0.52
#&gt; 
#&gt; , , variable = mu[1]
#&gt; 
#&gt;          chain
#&gt; iteration    1   2    3    4
#&gt;         1 0.89 1.2 1.39 1.14
#&gt;         2 0.88 1.4 1.29 1.02
#&gt;         3 1.32 1.3 0.87 1.23
#&gt;         4 1.00 1.2 0.77 0.91
#&gt;         5 1.16 1.1 0.54 1.31
#&gt; 
#&gt; # ... with 1 more iterations</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(EVSPT_sim<span class="sc">$</span>array2))</span></code></pre></div>
<pre><code>#&gt; [1] 44 10</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(EVSPT_sim<span class="sc">$</span>array2))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 10
#&gt;   variable           mean  median      sd     mad      q5     q95  rhat ess_bulk
#&gt;   &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 c2[1]           1.23e+0 1.14e+0 5.32e-1 4.84e-1  0.547  2.26e+0  1.00    3737.
#&gt; 2 c3[1]           1.94e+0 1.91e+0 3.49e-1 3.38e-1  1.41   2.55e+0  1.00    3992.
#&gt; 3 c1[1]           4.46e-2 4.42e-2 4.15e-3 3.79e-3  0.0385 5.16e-2  1.00    3337.
#&gt; 4 bD[1]           1.80e+2 1.79e+2 1.04e+2 1.32e+2 17.5    3.42e+2  1.00    4716.
#&gt; 5 binPam_succA[1] 5.43e-1 5.46e-1 4.21e-2 4.09e-2  0.468  6.07e-1  1.00    4418.
#&gt; 6 binPam_succA[2] 5.74e-1 5.74e-1 3.09e-2 3.07e-2  0.523  6.24e-1  1.00    4750.
#&gt; # ℹ 1 more variable: ess_tail &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVSPT_sim<span class="sc">$</span>array3))</span></code></pre></div>
<pre><code>#&gt; [1] 4</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(EVSPT_sim<span class="sc">$</span>array3))</span></code></pre></div>
<pre><code>#&gt; $lenA
#&gt; [1] 2.0 3.0 3.5 4.0 4.5 5.0 6.0 8.0
#&gt; 
#&gt; $propA
#&gt; [1] 0.5333333 0.6333333 0.6666667 0.5000000 0.6000000 0.5000000 0.5333333
#&gt; [8] 0.5333333
#&gt; 
#&gt; $simulLA
#&gt; [1] 0.3333333 0.4000000 0.4000000 0.4000000 0.4000000 0.4000000 0.4000000
#&gt; [8] 0.4000000
#&gt; 
#&gt; $simulUA
#&gt; [1] 0.7333333 0.7666667 0.7666667 0.7666667 0.7666667 0.7666667 0.7666667
#&gt; [8] 0.7666667</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVSPT_sim<span class="sc">$</span>array4))</span></code></pre></div>
<pre><code>#&gt; [1] 4</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(EVSPT_sim<span class="sc">$</span>array4))</span></code></pre></div>
<pre><code>#&gt; $lenI
#&gt; [1] 0.08333333 0.16666667 0.25000000 0.33333333 0.41666667 0.50000000 0.66666667
#&gt; [8] 0.83333333 1.00000000
#&gt; 
#&gt; $propI
#&gt; [1] 0.1333333 0.2000000 0.3000000 0.4333333 0.4333333 0.2666667 0.4666667
#&gt; [8] 0.4333333 0.7333333
#&gt; 
#&gt; $simulLI
#&gt; [1] 0.03333333 0.06666667 0.13333333 0.16666667 0.20000000 0.23333333 0.26666667
#&gt; [8] 0.30000000 0.33333333
#&gt; 
#&gt; $simulUI
#&gt; [1] 0.2666667 0.3666667 0.4666667 0.5333333 0.5666667 0.6000000 0.6666667
#&gt; [8] 0.6666667 0.7000000</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVSPT_sim<span class="sc">$</span>array5))</span></code></pre></div>
<pre><code>#&gt; [1] 2</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(EVSPT_sim<span class="sc">$</span>array5))</span></code></pre></div>
<pre><code>#&gt; $bayesR2_mn
#&gt; [1] 0.4022436 0.6028043
#&gt; 
#&gt; $bayesR2_sd
#&gt; [1] 0.1049295 0.1227979</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVSPT_sim<span class="sc">$</span>converge_results))</span></code></pre></div>
<pre><code>#&gt; [1] 2</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(EVSPT_sim<span class="sc">$</span>converge_results))</span></code></pre></div>
<pre><code>#&gt; $divergent_transitions
#&gt; [1] 0
#&gt; 
#&gt; $max_treedepth_exceeded
#&gt; [1] FALSE</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>runs<span class="ot">=</span><span class="fu">dim</span>(target)[<span class="dv">1</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>nChains<span class="ot">=</span><span class="fu">dim</span>(target)[<span class="dv">2</span>]</span></code></pre></div>
<p><strong>estimate_virus_parameters_SPT function output and model
fit</strong></p>
<p>The above 7 objects that are returned from the
estimate_virus_parameters_SPT function are briefly as follows: array 0
and array 1 are the samples for estimated parameters. Array 0 includes
the 3 fitted parameters of the model which are composite parameters and
insect mortality as well as lp; array 1 is simply the viral parameters
that we are chiefly interested in here (they are derived from the
composite parameters). Array 2 contains summary statistics for a range
of parameters. It is returned primarily for model diagnostics purposes:
the columns rhat and ess_bullk can be checked if needed. Array 3 and
array 4 contain forward simulation of the access period data (array 3 is
the acquisition varying sub-assay, array 4 is the inoculation varying
sub-assay). Array 5 contains Bayesian R2 values which users may wish to
consult as measures of model fit (the first and second elements
correspond to the acquisition and inoculation varying sub-assays
respectively). Finally, converge_results provides values that confirm
model convergence (there must be no divergent transitions, and no max
tree depth exceeded instances).</p>
<p>NOTE that these are returned to provide flexibility for users to
examine model fit - but the absence of warnings that are printed to the
console is itself indicative of model convergence. The warnings
themselves can be checked with the warnings() command. Again this is not
really necessary as rstan convergence warnings will print to console,
but rechecking of warnings is here demonstrated for convenience.</p>
<p>An important diagnostic step in Bayesian model fitting is inspecting
pairs plots, which are particularly useful for visualising issues such
as divergent transitions and correlations - these complement the
explicit warnings of the stan sampler however which are the main port of
call. These plots display relationships between model parameters and
also include lp__, the log-posterior of the model, in addition bD
represents the rate of insect mortality in the laboratory,# modelled
here as a form of nuisance parameter (can theoretically influence the
duration of the final IAP phase in assays - but not generally a focal
model component). bD is assigned a uniform prior bounded by the minimum
possible survival time (0.1h) and the maximum insect survival under
natural conditions, as specified by the user (in days). Given this broad
prior and the typically fixed durations of experiments, the posterior
distribution of bD is expected to remain largely uninformative.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">warnings</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Warnings occurred during fitting; check convergence diagnostics.&quot;</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We use mcmc_pairs from the bayesplot package to perform pair plots of
parameters. Not displaying here to reduce runtime/size but can be run by
user to visualise the output.</p>
<p>Since we are satisfied with the model fits we proceed with the viral
parameter estimates, which we now display alone as density plots. Not
displaying here to reduce runtime/size but can be run by user to
visualise the output.</p>
<p>We can also plot that part of the function output concerning forward
predictions of the assay data (based upon the parameter estimates). One
can plot the original assay data (also included in the output) as well
as the 95% credible interval. Plots confirm that the 95% credible
interval is very good fit for the data.</p>
<p><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,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" /><!-- --></p>
<p><strong>We now extract the parameter estimates for use in the
calculation of local epidemic probability.</strong> The posterior
distributions now have the form of matrices within a 3D array, third
dimension is the parameter (dimensions: iterations x no. Markov-chains).
We also prepare the local parameters.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P EPIDEMIC inferences</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># accessing the chains from estimate_virus_parameters</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># VIRUS PARAMETERS</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># convert from per hours to per day</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>al_fits<span class="ot">=</span>target[,,<span class="fu">dimnames</span>(target)<span class="sc">$</span>variable<span class="sc">==</span><span class="st">&quot;al[1]&quot;</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]<span class="sc">*</span><span class="dv">24</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>be_fits<span class="ot">=</span>target[,,<span class="fu">dimnames</span>(target)<span class="sc">$</span>variable<span class="sc">==</span><span class="st">&quot;be[1]&quot;</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]<span class="sc">*</span><span class="dv">24</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>mu_fits<span class="ot">=</span>target[,,<span class="fu">dimnames</span>(target)<span class="sc">$</span>variable<span class="sc">==</span><span class="st">&quot;mu[1]&quot;</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]<span class="sc">*</span><span class="dv">24</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#confirm there are no negative values</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>((al_fits<span class="sc">&lt;</span><span class="dv">0</span>)))</span></code></pre></div>
<pre><code>#&gt; [1] 0</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>((be_fits<span class="sc">&lt;</span><span class="dv">0</span>)))</span></code></pre></div>
<pre><code>#&gt; [1] 0</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>((mu_fits<span class="sc">&lt;</span><span class="dv">0</span>)))</span></code></pre></div>
<pre><code>#&gt; [1] 0</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LOCAL PARAMETERS</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set the local parameters rates (per day)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>thet_external <span class="ot">&lt;-</span> <span class="fl">0.45</span> <span class="co"># dispersal</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>r_external  <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">28</span> <span class="co"># roguing</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>bf_external <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>  <span class="co"># vector mortality</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>h_external <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">365</span>  <span class="co"># harvesting rate</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>nu_pl_external <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>  <span class="co"># plant latent progression rate (1/plant latent period)</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>localParams<span class="ot">=</span><span class="fu">c</span>(thet_external, r_external, h_external, bf_external, nu_pl_external)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># generate p Epdemic results for given insect burden (per plant)</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>numInsects<span class="ot">=</span><span class="dv">3</span></span></code></pre></div>
<p>Typically if one wishes to convert the virus parameter estimates into
epidemic probability estimates one would use all of the posterior
samples. <em>In this vignette for simplicity however we only look at the
last 10 posterior samples (runsPrag=10)</em>. Users alternatively may
already have a set of virus parameter values they wish to calculate
epidemic probability from - in which case they would typically just run
the function for a single parameter set.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>runsPrag<span class="ot">=</span><span class="dv">10</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># initial guess for expected time in hours until next event - the function will use this </span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to work out efficient time step (optional, default = 0.1)</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>interval_ind<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">10</span> <span class="co">#</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># initialising vectors for storing chain samples</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>result_vec_byPl <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>, runsPrag<span class="sc">*</span>nChains), <span class="at">dim=</span><span class="fu">c</span>(runsPrag,nChains))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>result_vec_byIns <span class="ot">&lt;-</span> result_vec_byPl</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">identical</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;NOT_CRAN&quot;</span>), <span class="st">&quot;true&quot;</span>)) {</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through MCMC chains to sample posterior distributions of virus parameters and </span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate epidemic probability for a given vector abundance</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ggg <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nChains){</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;nChains&#39;</span>,ggg))</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ppp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>runsPrag) {</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    al_estim<span class="ot">=</span>al_fits[<span class="fu">nrow</span>(al_fits)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>ppp,ggg]</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    be_estim<span class="ot">=</span>be_fits[<span class="fu">nrow</span>(al_fits)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>ppp,ggg]</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    mu_estim<span class="ot">=</span>mu_fits[<span class="fu">nrow</span>(al_fits)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>ppp,ggg]</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    virusParams<span class="ot">=</span><span class="fu">c</span>(al_estim,be_estim,mu_estim)</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># returns vector of epidemic probabilities for different inoculum states (see ms)</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    numVars <span class="ot">&lt;-</span> ((numInsects<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">3</span>)<span class="sc">-</span><span class="dv">1</span>  <span class="co"># insects per plant number no. inoculum states</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    qm_out<span class="ot">=</span><span class="fu">calculate_epidemic_probability</span>(numInsects,interval_ind,localParams,virusParams)</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    result_vec_byPl[ppp,ggg]<span class="ot">=</span>qm_out[<span class="dv">1</span>]  <span class="co"># storing epi prob for state: inoculum=single infected plant</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>    result_vec_byIns[ppp,ggg]<span class="ot">=</span>qm_out[(numVars<span class="sc">-</span>(numInsects<span class="dv">-1</span>))]  <span class="co"># storing for state: single infected insect</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load precomputed object for CRAN</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>  result_vec_byPl <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;result_vec_byPl.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>))</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>  result_vec_byIns <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;result_vec_byIns.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>))</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>#&gt; [1] &quot;nChains1&quot;
#&gt; [1] &quot;nChains2&quot;
#&gt; [1] &quot;nChains3&quot;
#&gt; [1] &quot;nChains4&quot;</code></pre>
<p>The output data is itself a posterior distribution - <em>though in
this vignette we have only looked at a small number of samples from the
virus parameters posterior distributions so results generated should be
seen as illustrative only</em>. We can now use as_draws and
summarize_draws from the posterior package to extract median values and
credible intervals for the epidemic probabilities.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data wrangling the set of epidemic probabilities from the chains</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>data_table_Pl<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>data_table_Ins<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>target_A1A2<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">2</span><span class="sc">*</span>runsPrag<span class="sc">*</span>nChains), <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">2</span>,runsPrag<span class="sc">*</span>nChains))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for a given level of insect use &#39;summarise_draws&#39; to calculate credible intervals</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>target_A1<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,runsPrag<span class="sc">*</span>nChains), <span class="at">dim=</span><span class="fu">c</span>(runsPrag, nChains))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>target_A2<span class="ot">=</span>target_A1</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (gg <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nChains){</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  target_A1[,gg]<span class="ot">=</span><span class="fu">t</span>(result_vec_byPl[,gg])</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  target_A2[,gg]<span class="ot">=</span><span class="fu">t</span>(result_vec_byIns[,gg])</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>target_A1A2<span class="ot">=</span><span class="fu">rbind</span>(<span class="fu">as.vector</span>(target_A1),<span class="fu">as.vector</span>(target_A2))</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co"># first the first few elements of epidemic probability from plant inocula</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(target_A1A2))</span></code></pre></div>
<pre><code>#&gt;           [,1]      [,2]      [,3]       [,4]      [,5]       [,6]      [,7]
#&gt; [1,] 0.4090764 0.4682394 0.4154336 0.41814793 0.5032385 0.41386601 0.3796092
#&gt; [2,] 0.2496414 0.0960539 0.2172533 0.07959456 0.3254625 0.08569986 0.2612211
#&gt;           [,8]      [,9]     [,10]     [,11]     [,12]     [,13]     [,14]
#&gt; [1,] 0.4544358 0.3538230 0.3221268 0.4384896 0.4451384 0.4787830 0.4833741
#&gt; [2,] 0.3178085 0.1097756 0.1089286 0.1359862 0.1998165 0.1899531 0.1696971
#&gt;          [,15]     [,16]     [,17]     [,18]     [,19]     [,20]      [,21]
#&gt; [1,] 0.4191975 0.3850002 0.4414056 0.4327597 0.4618531 0.4228228 0.46779572
#&gt; [2,] 0.2866789 0.2708068 0.3051165 0.2870660 0.1135582 0.1223621 0.08266381
#&gt;          [,22]     [,23]     [,24]     [,25]     [,26]     [,27]     [,28]
#&gt; [1,] 0.4145338 0.5302213 0.4426165 0.4541618 0.4719079 0.4027707 0.5025549
#&gt; [2,] 0.3245552 0.1769686 0.2816991 0.2955441 0.3770555 0.2167704 0.3141242
#&gt;           [,29]      [,30]     [,31]     [,32]     [,33]      [,34]      [,35]
#&gt; [1,] 0.35839271 0.42937000 0.4707700 0.3694549 0.4205614 0.37781941 0.34206085
#&gt; [2,] 0.05774426 0.09456124 0.1253498 0.3061306 0.1190870 0.05819241 0.03580648
#&gt;          [,36]     [,37]      [,38]     [,39]     [,40]
#&gt; [1,] 0.3347991 0.4232885 0.43922452 0.3988409 0.3814825
#&gt; [2,] 0.1676110 0.1983307 0.06815127 0.2714797 0.2692940</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and from insect inocula</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(target_A1A2))</span></code></pre></div>
<pre><code>#&gt;           [,1]      [,2]      [,3]       [,4]      [,5]       [,6]      [,7]
#&gt; [1,] 0.4090764 0.4682394 0.4154336 0.41814793 0.5032385 0.41386601 0.3796092
#&gt; [2,] 0.2496414 0.0960539 0.2172533 0.07959456 0.3254625 0.08569986 0.2612211
#&gt;           [,8]      [,9]     [,10]     [,11]     [,12]     [,13]     [,14]
#&gt; [1,] 0.4544358 0.3538230 0.3221268 0.4384896 0.4451384 0.4787830 0.4833741
#&gt; [2,] 0.3178085 0.1097756 0.1089286 0.1359862 0.1998165 0.1899531 0.1696971
#&gt;          [,15]     [,16]     [,17]     [,18]     [,19]     [,20]      [,21]
#&gt; [1,] 0.4191975 0.3850002 0.4414056 0.4327597 0.4618531 0.4228228 0.46779572
#&gt; [2,] 0.2866789 0.2708068 0.3051165 0.2870660 0.1135582 0.1223621 0.08266381
#&gt;          [,22]     [,23]     [,24]     [,25]     [,26]     [,27]     [,28]
#&gt; [1,] 0.4145338 0.5302213 0.4426165 0.4541618 0.4719079 0.4027707 0.5025549
#&gt; [2,] 0.3245552 0.1769686 0.2816991 0.2955441 0.3770555 0.2167704 0.3141242
#&gt;           [,29]      [,30]     [,31]     [,32]     [,33]      [,34]      [,35]
#&gt; [1,] 0.35839271 0.42937000 0.4707700 0.3694549 0.4205614 0.37781941 0.34206085
#&gt; [2,] 0.05774426 0.09456124 0.1253498 0.3061306 0.1190870 0.05819241 0.03580648
#&gt;          [,36]     [,37]      [,38]     [,39]     [,40]
#&gt; [1,] 0.3347991 0.4232885 0.43922452 0.3988409 0.3814825
#&gt; [2,] 0.1676110 0.1983307 0.06815127 0.2714797 0.2692940</code></pre>
<p>Printing median values and and credible intervals for the epidemic
probabilities. This is conditioned on a local environment with
numInsects=3 insect vectors per host plant, and on the earlier defined
local rates.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure at least ~20 data points for each of 4 chains (ie cant summarise distribution if v small)</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ts<span class="ot">=</span>posterior<span class="sc">::</span><span class="fu">summarize_draws</span>(posterior<span class="sc">::</span><span class="fu">as_draws</span>(<span class="fu">t</span>(target_A1A2))) </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>data_table_Pl<span class="ot">=</span><span class="fu">c</span>(ts[<span class="dv">1</span>,]<span class="sc">$</span>median,ts[<span class="dv">1</span>,]<span class="sc">$</span>q5,ts[<span class="dv">1</span>,]<span class="sc">$</span>q95)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>data_table_Ins<span class="ot">=</span><span class="fu">c</span>(ts[<span class="dv">2</span>,]<span class="sc">$</span>median,ts[<span class="dv">2</span>,]<span class="sc">$</span>q5,ts[<span class="dv">2</span>,]<span class="sc">$</span>q95)</span></code></pre></div>
<p>And then printing the summary statistics of local epidemic
probability (median and default 90% credible interval from
summarize_draws() here for simplicity). Adjust code for e.g. 95%
intervals as needed.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_table_Pl)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;50&#39;</span>,<span class="st">&#39;5&#39;</span>,<span class="st">&#39;95&#39;</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_table_Pl)</span></code></pre></div>
<pre><code>#&gt;        50         5        95 
#&gt; 0.4230557 0.3416978 0.5025890</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_table_Ins)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;50&#39;</span>,<span class="st">&#39;5&#39;</span>,<span class="st">&#39;95&#39;</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_table_Ins)</span></code></pre></div>
<pre><code>#&gt;        50         5        95 
#&gt; 0.1941419 0.0581700 0.3246005</code></pre>
<p><strong>Repeating the entire process for a PT virus
dataset.</strong></p>
<p>Loading the example dataset for a PT virus. See package documentation
entry for the ap_data_sim_PT dataset for explanation of the dataset
columns which correspond to AP experiment structure.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>virus_type<span class="ot">=</span><span class="st">&#39;PT&#39;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ap_data_sim_PT&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ap_data_sim_PT)</span></code></pre></div>
<pre><code>#&gt; $d_AAP
#&gt;       [,1] [,2]  [,3] [,4]  [,5] [,6] [,7] [,8]
#&gt; T_vec    1  1.5  1.75    2  2.25  2.5    3    4
#&gt; R_vec   30 30.0 30.00   30 30.00 30.0   30   30
#&gt; I_vec   11 20.0 20.00   23 23.00 25.0   28   30
#&gt; 
#&gt; $d_LAP
#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
#&gt; T_vec  0.5    1    2    3    4    5    6    7    8
#&gt; R_vec 30.0   30   30   30   30   30   30   30   30
#&gt; I_vec 29.0   25   25   28   26   28   28   27   26
#&gt; 
#&gt; $d_IAP
#&gt;              [,1]       [,2]  [,3]       [,4]       [,5] [,6]       [,7]
#&gt; T_vec  0.08333333  0.1666667  0.25  0.3333333  0.4166667  0.5  0.6666667
#&gt; R_vec 30.00000000 30.0000000 30.00 30.0000000 30.0000000 30.0 30.0000000
#&gt; I_vec  4.00000000 12.0000000  9.00 19.0000000 21.0000000 13.0 22.0000000
#&gt;             [,8] [,9]
#&gt; T_vec  0.8333333    1
#&gt; R_vec 30.0000000   30
#&gt; I_vec 22.0000000   26
#&gt; 
#&gt; $d_durations
#&gt;                   [,1] [,2] [,3]
#&gt; AAPfixedComponent   -1  0.5    1
#&gt; LAPfixedComponent    2 -1.0    1
#&gt; IAPfixedComponent    2  0.5   -1
#&gt; 
#&gt; $d_vectorspp
#&gt; [1] 20
#&gt; 
#&gt; $d_virusType
#&gt; [1] &quot;PT&quot;
#&gt; 
#&gt; attr(,&quot;alpha&quot;)
#&gt; [1] 0.1
#&gt; attr(,&quot;beta&quot;)
#&gt; [1] 1
#&gt; attr(,&quot;gamma&quot;)
#&gt; [1] 0.5
#&gt; attr(,&quot;mu&quot;)
#&gt; [1] 0.01</code></pre>
<p>Note: for runtime reasons, CRAN runs a precomputed fit. To rerun the
full analysis, set Sys.setenv(NOT_CRAN = “true”) before rebuilding the
vignette.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">identical</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;NOT_CRAN&quot;</span>), <span class="st">&quot;true&quot;</span>)) {</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>EVPT_sim<span class="ot">=</span><span class="fu">estimate_virus_parameters_PT</span>(ap_data_sim_PT,lsEst_in,<span class="at">D_numPtsPdin=</span><span class="dv">1</span>,<span class="at">mcmcOptions=</span><span class="fu">c</span>(<span class="dv">1000</span>,<span class="dv">2000</span>),<span class="at">numChainsIn=</span><span class="dv">4</span>,<span class="at">mc.parallel=</span><span class="dv">0</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load precomputed object for CRAN</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  EVPT_sim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;EVPT_sim.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>#&gt; [1] &quot;numChains = 4&quot;
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_PT_virus&#39; NOW (CHAIN 1).
#&gt; Chain 1: Rejecting initial value:
#&gt; Chain 1:   Error evaluating the log probability at the initial value.
#&gt; Chain 1: Exception: beta_lpdf: Random variable is 3.30288, but must be in the interval [0, 1] (in &#39;string&#39;, line 205, column 2 to column 25)
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 0.000421 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 4.21 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
#&gt; Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
#&gt; Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
#&gt; Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
#&gt; Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
#&gt; Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
#&gt; Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 14.669 seconds (Warm-up)
#&gt; Chain 1:                12.022 seconds (Sampling)
#&gt; Chain 1:                26.691 seconds (Total)
#&gt; Chain 1: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_PT_virus&#39; NOW (CHAIN 2).
#&gt; Chain 2: 
#&gt; Chain 2: Gradient evaluation took 0.000534 seconds
#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 5.34 seconds.
#&gt; Chain 2: Adjust your expectations accordingly!
#&gt; Chain 2: 
#&gt; Chain 2: 
#&gt; Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
#&gt; Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
#&gt; Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
#&gt; Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
#&gt; Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
#&gt; Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
#&gt; Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
#&gt; Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
#&gt; Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
#&gt; Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
#&gt; Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
#&gt; Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
#&gt; Chain 2: 
#&gt; Chain 2:  Elapsed Time: 15.522 seconds (Warm-up)
#&gt; Chain 2:                17.07 seconds (Sampling)
#&gt; Chain 2:                32.592 seconds (Total)
#&gt; Chain 2: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_PT_virus&#39; NOW (CHAIN 3).
#&gt; Chain 3: Rejecting initial value:
#&gt; Chain 3:   Error evaluating the log probability at the initial value.
#&gt; Chain 3: Exception: beta_lpdf: Random variable is 3.58098, but must be in the interval [0, 1] (in &#39;string&#39;, line 205, column 2 to column 25)
#&gt; Chain 3: 
#&gt; Chain 3: Gradient evaluation took 0.000317 seconds
#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 3.17 seconds.
#&gt; Chain 3: Adjust your expectations accordingly!
#&gt; Chain 3: 
#&gt; Chain 3: 
#&gt; Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
#&gt; Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
#&gt; Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
#&gt; Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
#&gt; Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
#&gt; Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
#&gt; Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
#&gt; Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
#&gt; Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
#&gt; Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
#&gt; Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
#&gt; Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
#&gt; Chain 3: 
#&gt; Chain 3:  Elapsed Time: 15.685 seconds (Warm-up)
#&gt; Chain 3:                12.856 seconds (Sampling)
#&gt; Chain 3:                28.541 seconds (Total)
#&gt; Chain 3: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;APmodel_PT_virus&#39; NOW (CHAIN 4).
#&gt; Chain 4: Rejecting initial value:
#&gt; Chain 4:   Error evaluating the log probability at the initial value.
#&gt; Chain 4: Exception: beta_lpdf: Random variable is 5.62922, but must be in the interval [0, 1] (in &#39;string&#39;, line 205, column 2 to column 25)
#&gt; Chain 4: 
#&gt; Chain 4: Gradient evaluation took 0.000276 seconds
#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 2.76 seconds.
#&gt; Chain 4: Adjust your expectations accordingly!
#&gt; Chain 4: 
#&gt; Chain 4: 
#&gt; Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
#&gt; Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
#&gt; Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
#&gt; Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
#&gt; Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
#&gt; Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
#&gt; Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
#&gt; Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
#&gt; Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
#&gt; Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
#&gt; Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
#&gt; Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
#&gt; Chain 4: 
#&gt; Chain 4:  Elapsed Time: 14.079 seconds (Warm-up)
#&gt; Chain 4:                11.476 seconds (Sampling)
#&gt; Chain 4:                25.555 seconds (Total)
#&gt; Chain 4:</code></pre>
<pre><code>#&gt; E-BFMI indicated no pathological behavior.</code></pre>
<pre><code>#&gt; MESSAGE: Check core convergence diagnostics and model fit!
#&gt;  - First: Review RStan sampling messages for warnings (do NOT suppress them).
#&gt;  - R-hat &lt; 1.05 for all parameters - see array 2.
#&gt;  - Effective Sample Size (ESS) ~&gt;= 100 per chain - see array 2.
#&gt;  - Posterior predictive fit: compare simulated vs. observed (arrays 3, 4, 5).
#&gt;  - No divergent transitions or treedepth exceedances - see converge_results.
#&gt;  More details:
#&gt;     Function help &amp; vignette (includes advanced diagnostics)
#&gt;     Stan diagnostics guide: https://mc-stan.org/docs/stan-users-guide/diagnostics.html</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>target<span class="ot">=</span>EVPT_sim<span class="sc">$</span>array1</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>runs<span class="ot">=</span><span class="fu">dim</span>(target)[<span class="dv">1</span>]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>nChains<span class="ot">=</span><span class="fu">dim</span>(target)[<span class="dv">2</span>]</span></code></pre></div>
<p>Taking a quick look at estimate_virus_parameters_PT’s output:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(EVPT_sim<span class="sc">$</span>array0))</span></code></pre></div>
<pre><code>#&gt; [1] 1000    4    6</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>array0)</span></code></pre></div>
<pre><code>#&gt; # A draws_array: 6 iterations, 4 chains, and 6 variables
#&gt; , , variable = al[1]
#&gt; 
#&gt;          chain
#&gt; iteration    1     2    3     4
#&gt;         1 0.11 0.096 0.13 0.207
#&gt;         2 0.11 0.097 0.16 0.199
#&gt;         3 0.12 0.104 0.11 0.099
#&gt;         4 0.11 0.103 0.12 0.128
#&gt;         5 0.11 0.089 0.11 0.107
#&gt; 
#&gt; , , variable = be[1]
#&gt; 
#&gt;          chain
#&gt; iteration   1    2   3    4
#&gt;         1 1.4 1.31 1.5 0.93
#&gt;         2 1.4 1.06 1.1 1.13
#&gt;         3 1.3 0.99 1.4 2.28
#&gt;         4 1.5 0.96 1.6 0.98
#&gt;         5 1.5 1.84 1.5 1.02
#&gt; 
#&gt; , , variable = mu_lat[1]
#&gt; 
#&gt;          chain
#&gt; iteration     1     2    3     4
#&gt;         1 0.125 0.083 0.21 0.228
#&gt;         2 0.115 0.033 0.26 0.419
#&gt;         3 0.112 0.033 0.13 0.183
#&gt;         4 0.078 0.028 0.21 0.099
#&gt;         5 0.111 0.031 0.14 0.047
#&gt; 
#&gt; , , variable = lat[1]
#&gt; 
#&gt;          chain
#&gt; iteration    1    2    3    4
#&gt;         1 0.42 0.55 0.26 0.25
#&gt;         2 0.40 0.50 0.32 0.27
#&gt;         3 0.43 0.51 0.34 0.30
#&gt;         4 0.44 0.48 0.32 0.43
#&gt;         5 0.34 0.51 0.33 0.52
#&gt; 
#&gt; # ... with 1 more iterations, and 2 more variables</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(EVPT_sim<span class="sc">$</span>array1))</span></code></pre></div>
<pre><code>#&gt; [1] 1000    4    4</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>array1)</span></code></pre></div>
<pre><code>#&gt; # A draws_array: 6 iterations, 4 chains, and 4 variables
#&gt; , , variable = al[1]
#&gt; 
#&gt;          chain
#&gt; iteration    1     2    3     4
#&gt;         1 0.11 0.096 0.13 0.207
#&gt;         2 0.11 0.097 0.16 0.199
#&gt;         3 0.12 0.104 0.11 0.099
#&gt;         4 0.11 0.103 0.12 0.128
#&gt;         5 0.11 0.089 0.11 0.107
#&gt; 
#&gt; , , variable = be[1]
#&gt; 
#&gt;          chain
#&gt; iteration   1    2   3    4
#&gt;         1 1.4 1.31 1.5 0.93
#&gt;         2 1.4 1.06 1.1 1.13
#&gt;         3 1.3 0.99 1.4 2.28
#&gt;         4 1.5 0.96 1.6 0.98
#&gt;         5 1.5 1.84 1.5 1.02
#&gt; 
#&gt; , , variable = mu[1]
#&gt; 
#&gt;          chain
#&gt; iteration     1     2     3     4
#&gt;         1 0.053 0.046 0.053 0.057
#&gt;         2 0.046 0.016 0.084 0.112
#&gt;         3 0.048 0.017 0.045 0.054
#&gt;         4 0.034 0.013 0.068 0.043
#&gt;         5 0.038 0.016 0.047 0.024
#&gt; 
#&gt; , , variable = lat[1]
#&gt; 
#&gt;          chain
#&gt; iteration    1    2    3    4
#&gt;         1 0.42 0.55 0.26 0.25
#&gt;         2 0.40 0.50 0.32 0.27
#&gt;         3 0.43 0.51 0.34 0.30
#&gt;         4 0.44 0.48 0.32 0.43
#&gt;         5 0.34 0.51 0.33 0.52
#&gt; 
#&gt; # ... with 1 more iterations</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(EVPT_sim<span class="sc">$</span>array2))</span></code></pre></div>
<pre><code>#&gt; [1] 63 10</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>array2)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 10
#&gt;   variable      mean   median       sd      mad       q5     q95  rhat ess_bulk
#&gt;   &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 lat[1]      0.409    0.384    0.139    0.124   0.233     0.665  1.00    1447.
#&gt; 2 bD[1]     179.     179.     104.     137.     18.6     340.     1.00    3062.
#&gt; 3 al[1]       0.135    0.119    0.0609   0.0366  0.0774    0.243  1.00    1232.
#&gt; 4 be[1]       1.30     1.27     0.492    0.489   0.552     2.17   1.00    1669.
#&gt; 5 mu_lat[1]   0.137    0.101    0.126    0.105   0.00668   0.399  1.00    1209.
#&gt; 6 mu[1]       0.0440   0.0394   0.0305   0.0326  0.00385   0.102  1.00    1321.
#&gt; # ℹ 1 more variable: ess_tail &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVPT_sim<span class="sc">$</span>array3))</span></code></pre></div>
<pre><code>#&gt; [1] 4</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>array3)</span></code></pre></div>
<pre><code>#&gt; $lenA
#&gt; [1] 1.00 1.50 1.75 2.00 2.25 2.50 3.00 4.00
#&gt; 
#&gt; $propA
#&gt; [1] 0.3666667 0.6666667 0.6666667 0.7666667 0.7666667 0.8333333 0.9333333
#&gt; [8] 1.0000000
#&gt; 
#&gt; $simulLA
#&gt; [1] 0.3333333 0.5000000 0.5666667 0.6333333 0.7000000 0.7333333 0.8000000
#&gt; [8] 0.9000000
#&gt; 
#&gt; $simulUA
#&gt; [1] 0.7000000 0.8333333 0.9000000 0.9333333 0.9666667 1.0000000 1.0000000
#&gt; [8] 1.0000000</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVPT_sim<span class="sc">$</span>array4))</span></code></pre></div>
<pre><code>#&gt; [1] 4</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>array4)</span></code></pre></div>
<pre><code>#&gt; $lenL
#&gt; [1] 0.5 1.0 2.0 3.0 4.0 5.0 6.0 7.0 8.0
#&gt; 
#&gt; $propL
#&gt; [1] 0.9666667 0.8333333 0.8333333 0.9333333 0.8666667 0.9333333 0.9333333
#&gt; [8] 0.9000000 0.8666667
#&gt; 
#&gt; $simulLL
#&gt; [1] 0.6333333 0.7000000 0.7333333 0.7666667 0.8000000 0.8000000 0.7666667
#&gt; [8] 0.7666667 0.7666667
#&gt; 
#&gt; $simulUL
#&gt; [1] 0.9333333 0.9666667 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
#&gt; [8] 1.0000000 1.0000000</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVPT_sim<span class="sc">$</span>array5))</span></code></pre></div>
<pre><code>#&gt; [1] 4</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>array5)</span></code></pre></div>
<pre><code>#&gt; $lenI
#&gt; [1] 0.08333333 0.16666667 0.25000000 0.33333333 0.41666667 0.50000000 0.66666667
#&gt; [8] 0.83333333 1.00000000
#&gt; 
#&gt; $propI
#&gt; [1] 0.1333333 0.4000000 0.3000000 0.6333333 0.7000000 0.4333333 0.7333333
#&gt; [8] 0.7333333 0.8666667
#&gt; 
#&gt; $simulLI
#&gt; [1] 0.03333333 0.13333333 0.20000000 0.30000000 0.36666667 0.43333333 0.50000000
#&gt; [8] 0.60000000 0.63333333
#&gt; 
#&gt; $simulUI
#&gt; [1] 0.3000000 0.4666667 0.6000000 0.6666667 0.7333333 0.7666667 0.8333333
#&gt; [8] 0.9000000 0.9333333</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVPT_sim<span class="sc">$</span>array6))</span></code></pre></div>
<pre><code>#&gt; [1] 2</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>array6)</span></code></pre></div>
<pre><code>#&gt; $bayesR2_mn
#&gt; [1] 0.7617731 0.3886927 0.7291984
#&gt; 
#&gt; $bayesR2_sd
#&gt; [1] 0.13103613 0.08821937 0.08683528</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(EVPT_sim<span class="sc">$</span>converge_results))</span></code></pre></div>
<pre><code>#&gt; [1] 2</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(EVPT_sim<span class="sc">$</span>converge_results)</span></code></pre></div>
<pre><code>#&gt; $divergent_transitions
#&gt; [1] 0
#&gt; 
#&gt; $max_treedepth_exceeded
#&gt; [1] FALSE</code></pre>
<p>And indeed seeing if there were any warnings - NB may not be
essential persé - as rstan convergence warnings will print to console -
rechecking of warnings, however, demonstrated here for reference are
crucial and users must make sure that they have assessed convergence
diagnostics and model fit.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">warnings</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Warnings occurred during fitting; check convergence diagnostics.&quot;</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Displaying pairs plots for the parameter estimates of a PT virus
dataset. Not displaying here to reduce runtime/size but can be run by
user to visualise the output.</p>
<p>Since we are satisfied with the model fits we proceed with the viral
parameter estimates, which we now display alone as density plots. Not
displaying here to reduce runtime/size but can be run by user to
visualise the output.</p>
<p>Plotting forward simulated assay data based on the parameter
estimates against the original assay data.</p>
<p><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,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" /><!-- --></p>
<p>Extracting the Markov chain samples for the estimate virus
parameters, and calcuating epidemic probability based on a small number
of samples (*for illustration only).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P EPIDEMIC inferences</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># accessing the chains from estimate_virus_parameters</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co"># VIRUS PARAMETERS</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co"># convert from per min to per day</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>al_fits<span class="ot">=</span>target[,,<span class="fu">dimnames</span>(target)<span class="sc">$</span>variable<span class="sc">==</span><span class="st">&quot;al[1]&quot;</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]<span class="sc">*</span><span class="dv">24</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>be_fits<span class="ot">=</span>target[,,<span class="fu">dimnames</span>(target)<span class="sc">$</span>variable<span class="sc">==</span><span class="st">&quot;be[1]&quot;</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]<span class="sc">*</span><span class="dv">24</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>mu_fits<span class="ot">=</span>target[,,<span class="fu">dimnames</span>(target)<span class="sc">$</span>variable<span class="sc">==</span><span class="st">&quot;mu[1]&quot;</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]<span class="sc">*</span><span class="dv">24</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>((al_fits<span class="sc">&lt;</span><span class="dv">0</span>)))</span></code></pre></div>
<pre><code>#&gt; [1] 0</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>((be_fits<span class="sc">&lt;</span><span class="dv">0</span>)))</span></code></pre></div>
<pre><code>#&gt; [1] 0</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>((mu_fits<span class="sc">&lt;</span><span class="dv">0</span>)))</span></code></pre></div>
<pre><code>#&gt; [1] 0</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LOCAL PARAMETERS</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set the local parameters (per day)</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>thet_external <span class="ot">&lt;-</span> <span class="fl">0.45</span> <span class="co"># dispersal</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>r_external <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">28</span> <span class="co"># roguing</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>bf_external <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span> <span class="co"># vector mortality</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>h_external <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">365</span> <span class="co"># harvesting rate</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>nu_pl_external <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span> <span class="co"># plant latent progression rate (1/plant latent period)</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>localParams<span class="ot">=</span><span class="fu">c</span>(thet_external, r_external, h_external, bf_external, nu_pl_external)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># generate p Epdemic results for various insect burdens (per plant)</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>interval_ind<span class="ot">=</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="co"># this is an optional start setting relating to efficiency of time-step</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>result_vec_byPl_PT <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>, runsPrag<span class="sc">*</span>nChains), <span class="at">dim=</span><span class="fu">c</span>(runsPrag,nChains))</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>result_vec_byIns_PT <span class="ot">&lt;-</span> result_vec_byPl</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">identical</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;NOT_CRAN&quot;</span>), <span class="st">&quot;true&quot;</span>)) {</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through MCMC chains to sample posterior distributions of virus parameters</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co"># and calc epi prob for given vector abundance</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ggg <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nChains){</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;nChains&#39;</span>,ggg))</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (ppp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>runsPrag) {</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>  al_estim<span class="ot">=</span>al_fits[<span class="fu">nrow</span>(al_fits)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>ppp,ggg]</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>  be_estim<span class="ot">=</span>be_fits[<span class="fu">nrow</span>(al_fits)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>ppp,ggg]</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>  mu_estim<span class="ot">=</span>mu_fits[<span class="fu">nrow</span>(al_fits)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>ppp,ggg]</span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>  virusParams<span class="ot">=</span><span class="fu">c</span>(al_estim,be_estim,mu_estim)</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># returns vector of epidemic probabilities for different inoculum states (see ms)</span></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>  numVars <span class="ot">&lt;-</span> ((numInsects<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">3</span>)<span class="sc">-</span><span class="dv">1</span> <span class="co"># insects per plant number no. inoculum states</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>  qm_out<span class="ot">=</span><span class="fu">calculate_epidemic_probability</span>(numInsects,interval_ind,localParams,virusParams)</span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a>  result_vec_byPl_PT[ppp,ggg]<span class="ot">=</span>qm_out[<span class="dv">1</span>] <span class="co"># storing epi prob for state: inoculum=single infected plant</span></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>  result_vec_byIns_PT[ppp,ggg]<span class="ot">=</span>qm_out[(numVars<span class="sc">-</span>(numInsects<span class="dv">-1</span>))] <span class="co"># storingfor state: single infected insect</span></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load precomputed object for CRAN</span></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>  result_vec_byPl_PT <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;result_vec_byPl_PT.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>))</span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>  result_vec_byIns_PT <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;result_vec_byIns_PT.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;EpiPvr&quot;</span>))</span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>#&gt; [1] &quot;nChains1&quot;
#&gt; [1] &quot;nChains2&quot;
#&gt; [1] &quot;nChains3&quot;
#&gt; [1] &quot;nChains4&quot;</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now run the epidemic probability calculator</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># runtime for a single parameter set is fast</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># runtime for a MCMC chains (potentially very many parameter sets) may take substantial time</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co"># data wrangling the set of epidemic probabilities from the chains</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>data_table_Pl<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>data_table_Ins<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>target_A1A2<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">2</span><span class="sc">*</span>runsPrag<span class="sc">*</span>nChains), <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">2</span>,runsPrag<span class="sc">*</span>nChains))</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>target_A1<span class="ot">=</span><span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">0</span>,runsPrag<span class="sc">*</span>nChains), <span class="at">dim=</span><span class="fu">c</span>(runsPrag, nChains))</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>target_A2<span class="ot">=</span>target_A1</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (gg <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nChains){</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a> target_A1[,gg]<span class="ot">=</span><span class="fu">t</span>(result_vec_byPl_PT[,gg])</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a> target_A2[,gg]<span class="ot">=</span><span class="fu">t</span>(result_vec_byIns_PT[,gg])</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>target_A1A2<span class="ot">=</span><span class="fu">rbind</span>(<span class="fu">as.vector</span>(target_A1),<span class="fu">as.vector</span>(target_A2))</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure at least ~20 data points for each of 4 chains</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>ts<span class="ot">=</span>posterior<span class="sc">::</span><span class="fu">summarize_draws</span>(posterior<span class="sc">::</span><span class="fu">as_draws</span>(<span class="fu">t</span>(target_A1A2))) </span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>data_table_Pl<span class="ot">=</span><span class="fu">c</span>(ts[<span class="dv">1</span>,]<span class="sc">$</span>median,ts[<span class="dv">1</span>,]<span class="sc">$</span>q5,ts[<span class="dv">1</span>,]<span class="sc">$</span>q95)</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>data_table_Ins<span class="ot">=</span><span class="fu">c</span>(ts[<span class="dv">2</span>,]<span class="sc">$</span>median,ts[<span class="dv">2</span>,]<span class="sc">$</span>q5,ts[<span class="dv">2</span>,]<span class="sc">$</span>q95)</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(target_A1A2[<span class="dv">1</span>,]))</span></code></pre></div>
<pre><code>#&gt; [1] 0.9926764 0.9852395 0.9914037 0.9864083 0.9879731 0.9906856</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(target_A1A2[<span class="dv">2</span>,]))</span></code></pre></div>
<pre><code>#&gt; [1] 0.9313996 0.9291436 0.9363168 0.9016873 0.9219091 0.9339747</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nb default summarize_draws 90% interval - please adjust for 95%</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_table_Pl)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;50&#39;</span>,<span class="st">&#39;5&#39;</span>,<span class="st">&#39;95&#39;</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_table_Pl)</span></code></pre></div>
<pre><code>#&gt;        50         5        95 
#&gt; 0.9895013 0.9865916 0.9929702</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_table_Ins)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;50&#39;</span>,<span class="st">&#39;5&#39;</span>,<span class="st">&#39;95&#39;</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_table_Ins)</span></code></pre></div>
<pre><code>#&gt;        50         5        95 
#&gt; 0.9215686 0.8561469 0.9463177</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
